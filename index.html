<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resuelve el Sudoku para un Mensaje Especial 仇벒잺</title>
    <style>
        /* --- ESTILOS BASE --- */
        body {
            margin: 0; padding: 0;
            background: linear-gradient(to top, #e6f7ff, #ffe0f5); /* Fondo suave */
            height: 100vh; width: 100vw; 
            overflow: auto; /* Permitir scroll si la carta es muy larga en m칩vil */
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            display: flex; flex-direction: column; justify-content: flex-start; /* Alineaci칩n arriba */
            align-items: center;
            color: #d63031;
            padding-top: 5vh; /* Espacio superior para centrar mejor en la vista inicial */
            box-sizing: border-box;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 0px #fff;
            text-align: center;
            padding: 0 10px;
        }

        /* --- SUDOKU CONTAINER --- */
        #sudoku-container {
            display: grid;
            grid-template-columns: repeat(4, 60px); 
            grid-template-rows: repeat(4, 60px);   
            gap: 2px;
            border: 4px solid #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
            margin-bottom: 20px;
            background-color: #fff;
            touch-action: manipulation; /* Mejora la interacci칩n t치ctil en m칩viles */
        }

        .sudoku-cell {
            width: 60px; height: 60px;
            background-color: #fff;
            border: 1px solid #ffb8b8;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: bold;
            color: #333;
        }

        .sudoku-cell input {
            width: 90%; height: 90%;
            border: none; outline: none;
            text-align: center;
            font-size: 2rem; font-weight: bold;
            color: #4a4a4a;
            background: none;
        }

        .sudoku-cell.fixed {
            background-color: #ffe0e0; 
            color: #d63031;
            cursor: default;
        }

        /* Colores de validaci칩n */
        .sudoku-cell.correct input { color: #28a745 !important; } /* !important para asegurar que gane */
        .sudoku-cell.incorrect input { color: #dc3545 !important; }

        /* --- BOT칍N DE VERIFICACI칍N --- */
        #verify-button {
            background: #ff6b6b; color: white; border: none;
            padding: 12px 25px; border-radius: 25px; font-size: 1.2rem;
            cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background 0.3s, transform 0.1s;
        }
        #verify-button:hover { background: #ff4757; transform: translateY(-2px); }
        #verify-button:active { transform: translateY(0); }
        #verify-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        /* --- POPUP y CARTA FINAL --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center;
            visibility: hidden; opacity: 0; transition: all 0.5s; z-index: 2000;
        }
        .overlay.show { visibility: visible; opacity: 1; }

        .letter-content {
            background: #fffdf0; padding: 40px; border-radius: 15px; border: 3px solid #d4af37;
            text-align: center; max-width: 600px; width: 90%;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            animation: fadeInScale 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* Importante para m칩vil: permitir scroll dentro de la carta si es muy larga */
            max-height: 90vh; 
            overflow-y: auto;
        }

        @keyframes fadeInScale {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .letter-content h2 {
            color: #d4af37; margin-top:0; font-size: 2rem;
            display: flex; align-items: center; justify-content: center;
        }
        .letter-content h2::before, .letter-content h2::after {
            content: '游눘'; margin: 0 10px; font-size: 1.5rem;
        }

        .letter-text {
            font-family: 'Georgia', serif; font-size: 1.1rem; color: #333; 
            line-height: 1.6; margin: 20px 0;
            white-space: pre-wrap;
            text-align: left;
            padding: 0 10px;
        }

        .letter-signature {
            color: #ff6b6b; font-weight:bold; font-size: 1.2rem; margin-top: 20px;
            text-align: right;
            padding-right: 10px;
        }

        button {
            background: #ff6b6b; color: white; border: none; padding: 12px 25px;
            border-radius: 25px; font-size: 1.1rem; cursor: pointer; margin-top: 20px;
            transition: background 0.3s;
        }
        button:hover { background: #ff4757; }

        /* --- MEDIA QUERY: AJUSTES PARA M칍VIL (Max 600px) --- */
        @media (max-width: 600px) {
            body { padding-top: 2vh; } /* Menos padding superior en m칩vil */
            h1 { font-size: 1.5rem; margin-bottom: 20px; }
            
            #sudoku-container {
                /* Reducir el tama침o de la cuadr칤cula para m칩viles */
                grid-template-columns: repeat(4, 45px);
                grid-template-rows: repeat(4, 45px);
            }
            
            .sudoku-cell, .sudoku-cell input {
                width: 45px; height: 45px; 
                font-size: 1.4rem; /* Reducir la fuente del n칰mero */
            }
            
            #verify-button { padding: 10px 20px; font-size: 1rem; }
            
            /* Ajustes de la carta en m칩vil */
            .letter-content { padding: 25px 15px; width: 95%; }
            .letter-content h2 { font-size: 1.5rem; }
            .letter-content h2::before, .letter-content h2::after { font-size: 1.2rem; margin: 0 5px; }
            .letter-text { font-size: 0.95rem; }
            .letter-signature { font-size: 1rem; }
            button { padding: 10px 20px; font-size: 1rem; }
        }

    </style>
</head>
<body>

    <h1>Resuelve el Sudoku para un Mensaje Especial 游눗</h1>

    <div id="sudoku-container">
        </div>

    <button id="verify-button">Verificar Sudoku</button>

    <audio id="secret-audio" src="secret_song.mp3" preload="auto" loop></audio>

    <div id="letter-overlay" class="overlay">
        <div class="letter-content">
            <h2>Segunda Carta de Aniversario</h2>
            <p class="letter-text">
                Mi Evelyn, preciosa.
                <br>
                Recuerdo esa noche en que volviste, platicamos un rato y nos levantamos temprano.
                Ten칤a miedo, est치bamos a la expectativa pero juntos, y eso para m칤 es muy valioso.
                Te amo tanto porque s칠 que mi futuro est치 confiado en ti, porque s칠 que mi amor
                descansa en buenas manos y que todo lo que hagamos y avancemos nos perfecciona.
                游눗
                <br><br>
                Esta p치gina la hice para cada vez que no pueda estar sepas que esto lo hice con mucho amor,
                as칤 que una parte de m칤 est치 aqu칤.
            </p>
            <p class="letter-signature">Te amo siempre, mi preciosa :3</p>
            <button onclick="closePopup()">Guardar en mi coraz칩n</button>
        </div>
    </div>

    <script>
        const sudokuContainer = document.getElementById('sudoku-container');
        const verifyButton = document.getElementById('verify-button');
        const letterOverlay = document.getElementById('letter-overlay');
        const secretAudio = document.getElementById('secret-audio');

        // Soluci칩n del Sudoku 4x4
        const solution = [
            [1, 2, 3, 4],
            [3, 4, 1, 2],
            [2, 1, 4, 3],
            [4, 3, 2, 1]
        ];

        // Tablero inicial (0 para celdas vac칤as a llenar)
        const initialBoard = [
            [1, 0, 0, 4],
            [0, 4, 1, 0],
            [2, 0, 4, 0],
            [0, 3, 0, 1]
        ];

        let currentBoard = JSON.parse(JSON.stringify(initialBoard));

        // --- FUNCIONES DEL SUDOKU ---

        function generateSudoku() {
            sudokuContainer.innerHTML = '';
            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('sudoku-cell');

                    if (initialBoard[r][c] !== 0) {
                        cell.classList.add('fixed');
                        cell.textContent = initialBoard[r][c];
                    } else {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.min = '1';
                        input.max = '4';
                        input.maxLength = '1';
                        input.dataset.row = r;
                        input.dataset.col = c;
                        input.addEventListener('input', handleInput);
                        cell.appendChild(input);
                    }
                    sudokuContainer.appendChild(cell);
                }
            }
        }

        function handleInput(event) {
            const input = event.target;
            const row = parseInt(input.dataset.row);
            const col = parseInt(input.dataset.col);
            let value = parseInt(input.value);

            // Asegurarse de que solo haya un d칤gito entre 1 y 4
            if (isNaN(value) || value < 1 || value > 4 || input.value.length > 1) {
                // Si el valor es inv치lido o tiene m치s de 1 d칤gito
                input.value = input.value.slice(0, 1).replace(/[^1-4]/g, ''); // Deja el primer d칤gito si es 1-4
                if (input.value === '') {
                     currentBoard[row][col] = 0;
                } else {
                     currentBoard[row][col] = parseInt(input.value);
                }
            } else {
                currentBoard[row][col] = value;
            }

            // Limpiar clases de validaci칩n para que no estorbe hasta que le den a verificar
            input.parentElement.classList.remove('correct', 'incorrect');
        }

        function checkSudoku() {
            let allCorrect = true;
            const cells = sudokuContainer.querySelectorAll('.sudoku-cell');
            let cellIndex = 0;

            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    const cell = cells[cellIndex];
                    let userValue;
                    
                    if (initialBoard[r][c] !== 0) {
                        userValue = initialBoard[r][c];
                    } else {
                        userValue = currentBoard[r][c];
                    }

                    // Si la celda no es fija (tiene un input) se revisa la clase de validaci칩n
                    if (initialBoard[r][c] === 0) {
                        if (userValue === solution[r][c]) {
                            cell.classList.remove('incorrect');
                            cell.classList.add('correct');
                        } else {
                            cell.classList.remove('correct');
                            cell.classList.add('incorrect');
                            allCorrect = false;
                        }
                    } else if (userValue !== solution[r][c]) {
                         // Esto es solo una doble verificaci칩n por si acaso un valor fijo est치 mal
                        allCorrect = false; 
                    }

                    cellIndex++;
                }
            }

            if (allCorrect) {
                // Deshabilitar inputs
                sudokuContainer.querySelectorAll('input').forEach(input => {
                    input.disabled = true;
                    input.style.color = '#28a745';
                });
                verifyButton.disabled = true;
                showLetter();
            } else {
                alert("춰Sigue intent치ndolo, casi lo tienes!");
            }
        }

        // --- L칍GICA DE LA CARTA Y AUDIO ---

        function showLetter() {
            letterOverlay.classList.add('show');
            // 1. Intentar reproducir audio autom치ticamente (puede ser bloqueado por el navegador)
            secretAudio.play().catch(e => {
                console.warn("Reproducci칩n autom치tica de audio bloqueada.", e);
            });
        }

        function closePopup() {
            letterOverlay.classList.remove('show');
            // 2. Si el audio fue bloqueado en el paso 1, al hacer click, se garantiza la reproducci칩n
            secretAudio.play().catch(e => {
                console.warn("Audio a칰n bloqueado, aseg칰rate de que el navegador permita la reproducci칩n.", e);
            });
        }

        // --- INICIALIZACI칍N ---
        generateSudoku();
        verifyButton.addEventListener('click', checkSudoku);

        // Configuraci칩n inicial del audio
        secretAudio.volume = 0.5;
        secretAudio.loop = true;
    </script>

</body>
</html>
